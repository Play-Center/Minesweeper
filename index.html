<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Minesweeper</title>
<style>
  :root{
    --bg:#0b1020;
    --panel:#151a2e;
    --tile:#1b2140;
    --tile-hover:#232a52;
    --revealed:#0f1630;
    --accent:#7c5cff;
    --text:#e7e9f4;
    --muted:#aab0cf;
    --danger:#ff5277;
    --safe:#2ad4a3;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    background: radial-gradient(1200px 800px at 10% -10%, #1b2140 0%, #0b1020 50%, #070a15 100%);
    color:var(--text);
    display:flex;
    justify-content:center;
    align-items:flex-start;
    padding:24px;
    gap:24px;
  }

  .game{
    width:min(95vw, 860px);
  }

  header{
    background:var(--panel);
    border:1px solid #242a4a;
    box-shadow:0 8px 24px rgba(0,0,0,.3), inset 0 1px 0 rgba(255,255,255,.04);
    border-radius:16px;
    padding:14px 16px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    position:sticky;
    top:12px;
    z-index:2;
  }

  .brand{
    display:flex;align-items:center;gap:10px;font-weight:700;letter-spacing:.3px
  }
  .brand .dot{width:10px;height:10px;border-radius:50%;background:var(--accent);box-shadow:0 0 16px var(--accent)}

  .controls{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
  .control{
    background:var(--tile);
    border:1px solid #2a3158;
    padding:8px 10px;
    border-radius:10px;
    display:flex;align-items:center;gap:8px;
    font-size:14px;
    color:var(--muted);
  }
  .control strong{color:var(--text)}
  select,button{
    background:var(--tile);
    color:var(--text);
    border:1px solid #2a3158;
    padding:8px 10px;
    border-radius:10px;
    font-size:14px;
    cursor:pointer;
  }
  button:hover, select:hover{border-color:#4450a3}
  button.primary{background:var(--accent);border-color:transparent;color:white;font-weight:700}
  button.primary:hover{filter:brightness(1.05)}
  button.ghost{background:transparent;border-color:#39406a}
  .stat{min-width:80px;text-align:center}
  .stat .label{display:block;font-size:12px;color:var(--muted)}
  .stat .value{font-weight:700;letter-spacing:.5px}

  .board-wrap{
    margin-top:16px;
    background:var(--panel);
    border:1px solid #242a4a;
    border-radius:16px;
    padding:14px;
    box-shadow:0 12px 32px rgba(0,0,0,.35);
  }

  .board{
    display:grid;
    gap:4px;
    user-select:none;
    touch-action:manipulation;
  }

  .cell{
    width:34px; height:34px;
    display:grid; place-items:center;
    background:linear-gradient(180deg, var(--tile), #171d38);
    border:1px solid #2a3158;
    border-radius:8px;
    font-weight:800;
    font-size:16px;
    color:var(--text);
    cursor:pointer;
    transition:transform .02s ease, background .15s ease, border-color .15s ease;
  }
  .cell:hover{background:var(--tile-hover); border-color:#3a4480}
  .cell:active{transform:translateY(1px)}
  .cell.revealed{
    background:linear-gradient(180deg, var(--revealed), #0c1227);
    border-color:#28305a;
    cursor:default;
  }
  .cell.flag{color:var(--danger)}
  .cell.mine{background:#45122b;border-color:#6d1f3f}
  .cell.mine.revealed{background:#5f1434}
  .cell.exploded{animation:pop .4s ease}
  @keyframes pop{0%{transform:scale(1)} 40%{transform:scale(1.15)} 100%{transform:scale(1)}}

  .n1{color:#7cc4ff} .n2{color:#2ad4a3} .n3{color:#ffb86b}
  .n4{color:#df95ff} .n5{color:#ff8ba7} .n6{color:#89f0ff}
  .n7{color:#f0f3f7} .n8{color:#9aa3c9}

  footer{
    margin-top:14px;
    font-size:12px;
    color:var(--muted);
    text-align:center;
  }
  a{color:#a9b4ff}
</style>
</head>
<body>
  <div class="game">
    <header>
      <div class="brand">
        <span class="dot"></span>
        <div>Minesweeper</div>
      </div>
      <div class="controls">
        <div class="control">
          <label for="difficulty">Difficulty</label>
          <select id="difficulty" title="Choose difficulty">
            <option value="9x9x10">Beginner (9×9, 10 mines)</option>
            <option value="16x16x40" selected>Intermediate (16×16, 40)</option>
            <option value="30x16x99">Expert (30×16, 99)</option>
            <option value="custom">Custom…</option>
          </select>
        </div>
        <div class="control" id="customRow" style="display:none">
          <label>W×H×M</label>
          <input id="w" type="number" min="5" max="60" value="16" style="width:64px;background:var(--tile);color:var(--text);border:1px solid #2a3158;border-radius:8px;padding:6px" />
          <input id="h" type="number" min="5" max="40" value="16" style="width:64px;background:var(--tile);color:var(--text);border:1px solid #2a3158;border-radius:8px;padding:6px" />
          <input id="m" type="number" min="1" max="500" value="40" style="width:72px;background:var(--tile);color:var(--text);border:1px solid #2a3158;border-radius:8px;padding:6px" />
        </div>
        <button id="reset" class="primary" title="New game (R)">⟲ New</button>
        <button id="chord" class="ghost" title="Toggle chording (Space)">Chording: Off</button>
        <div class="control stat">
          <span class="label">Mines</span>
          <span class="value" id="mineCount">0</span>
        </div>
        <div class="control stat">
          <span class="label">Flags</span>
          <span class="value" id="flagCount">0</span>
        </div>
        <div class="control stat">
          <span class="label">Time</span>
          <span class="value" id="timer">0.0s</span>
        </div>
      </div>
    </header>

    <div class="board-wrap">
      <div id="board" class="board" aria-label="Minesweeper board" role="grid"></div>
    </div>

    <footer>
      Left‑click: reveal • Right‑click: flag • Middle‑click or Space (with mouse over a number): chord<br/>
      First click is always safe. Enjoy!
    </footer>
  </div>

<script>
(() => {
  const boardEl = document.getElementById('board');
  const mineCountEl = document.getElementById('mineCount');
  const flagCountEl = document.getElementById('flagCount');
  const timerEl = document.getElementById('timer');
  const resetBtn = document.getElementById('reset');
  const chordBtn = document.getElementById('chord');
  const diffSel = document.getElementById('difficulty');
  const customRow = document.getElementById('customRow');
  const wInput = document.getElementById('w');
  const hInput = document.getElementById('h');
  const mInput = document.getElementById('m');

  // Prevent context menu so right-click can flag
  boardEl.addEventListener('contextmenu', e => e.preventDefault());

  // State
  let W=16, H=16, M=40;
  let cells = [];
  let firstClick = true;
  let flags = 0;
  let revealed = 0;
  let timer = null, startTime = 0, running = false;
  let chording = false;
  let gameOver = false;

  function setGridSize(w,h){
    boardEl.style.gridTemplateColumns = `repeat(${w}, 34px)`;
    boardEl.style.gridTemplateRows = `repeat(${h}, 34px)`;
  }

  class Cell {
    constructor(x,y){
      this.x=x; this.y=y;
      this.index = y*W+x;
      this.mine=false;
      this.revealed=false;
      this.flag=false;
      this.adj=0;

      this.el = document.createElement('button');
      this.el.className='cell';
      this.el.setAttribute('role','gridcell');
      this.el.setAttribute('aria-label','hidden');
      this.el.addEventListener('mousedown', (e)=> handleMouseDown(e, this));
      this.el.addEventListener('mouseup', (e)=> e.preventDefault());
      this.el.addEventListener('mouseleave', (e)=> e.preventDefault());
    }
  }

  function neighbors(x,y){
    const res=[];
    for(let dy=-1; dy<=1; dy++){
      for(let dx=-1; dx<=1; dx++){
        if(dx===0 && dy===0) continue;
        const nx=x+dx, ny=y+dy;
        if(nx>=0 && nx<W && ny>=0 && ny<H){
          res.push(cells[ny*W+nx]);
        }
      }
    }
    return res;
  }

  function placeMines(safeX, safeY){
    // Simple shuffle-based mine placement avoiding first click and its neighbors
    const safeSet = new Set();
    safeSet.add(safeY*W+safeX);
    neighbors(safeX, safeY).forEach(c=> safeSet.add(c.index));

    const indices = Array.from({length: W*H}, (_,i)=>i).filter(i=>!safeSet.has(i));
    for(let i=indices.length-1; i>0; i--){
      const j = Math.floor(Math.random()*(i+1));
      [indices[i], indices[j]] = [indices[j], indices[i]];
    }
    for(let i=0;i<M;i++){
      const idx = indices[i];
      cells[idx].mine = true;
    }
    // Compute adjacency
    for(const c of cells){
      if(c.mine){ c.adj = -1; continue; }
      c.adj = neighbors(c.x, c.y).filter(n=>n.mine).length;
    }
  }

  function startTimer(){
    running = true;
    startTime = performance.now();
    timer = setInterval(()=>{
      const s = (performance.now()-startTime)/1000;
      timerEl.textContent = s.toFixed(1)+'s';
    }, 100);
  }
  function stopTimer(){
    running = false;
    if(timer){ clearInterval(timer); timer=null; }
  }

  function reveal(cell){
    if(cell.revealed || cell.flag || gameOver) return;
    cell.revealed=true;
    revealed++;
    cell.el.classList.add('revealed');
    cell.el.setAttribute('aria-label', cell.mine ? 'mine' : (cell.adj===0?'empty':`${cell.adj}`));
    if(cell.mine){
      cell.el.textContent='💣';
      cell.el.classList.add('mine','exploded');
      endGame(false);
      return;
    }
    if(cell.adj>0){
      cell.el.textContent = cell.adj;
      cell.el.classList.add('n'+cell.adj);
    } else {
      // flood fill
      for(const n of neighbors(cell.x, cell.y)){
        if(!n.revealed && !n.mine){
          reveal(n);
        }
      }
    }
    checkWin();
  }

  function toggleFlag(cell){
    if(cell.revealed || gameOver) return;
    cell.flag = !cell.flag;
    if(cell.flag){
      cell.el.textContent = '⚑';
      flags++;
      cell.el.classList.add('flag');
    }else{
      cell.el.textContent = '';
      flags--;
      cell.el.classList.remove('flag');
    }
    flagCountEl.textContent = flags;
  }

  function handleMouseDown(e, cell){
    e.preventDefault();
    if(gameOver) return;

    if(firstClick && e.button===0){
      // First reveal -> safe placement then reveal
      placeMines(cell.x, cell.y);
      firstClick=false;
      startTimer();
    }

    // Chording with middle click or left+right or chording mode toggle
    if(e.button===1 || (chording && e.button===0 && cell.revealed && cell.adj>0)){
      chord(cell);
      return;
    }

    if(e.button===0){
      reveal(cell);
    } else if(e.button===2){
      toggleFlag(cell);
    }
  }

  function chord(cell){
    if(!cell.revealed || cell.adj<=0) return;
    const neigh = neighbors(cell.x, cell.y);
    const flagged = neigh.filter(n=>n.flag).length;
    if(flagged === cell.adj){
      neigh.forEach(n=>{
        if(!n.flag && !n.revealed) reveal(n);
      });
    }
  }

  function endGame(win){
    gameOver = true;
    stopTimer();
    if(!win){
      // reveal all mines
      for(const c of cells){
        if(c.mine && !c.revealed){
          c.el.textContent='💣';
          c.el.classList.add('mine','revealed');
        }
      }
      resetBtn.textContent = '💥 Try Again';
    }else{
      resetBtn.textContent = '🏆 New Game';
    }
  }

  function checkWin(){
    const total = W*H;
    if(revealed === total - M){
      endGame(true);
    }
  }

  function newGame(){
    gameOver=false;
    firstClick=true;
    revealed=0; flags=0;
    mineCountEl.textContent = M;
    flagCountEl.textContent = 0;
    timerEl.textContent = '0.0s';
    stopTimer();
    resetBtn.textContent = '⟲ New';
    // Build grid
    boardEl.innerHTML='';
    setGridSize(W,H);
    cells = [];
    for(let y=0;y<H;y++){
      for(let x=0;x<W;x++){
        const c = new Cell(x,y);
        cells.push(c);
        boardEl.appendChild(c.el);
      }
    }
  }

  function applyDifficulty(value){
    if(value==='custom'){
      customRow.style.display='flex';
      W = clamp(parseInt(wInput.value||16), 5, 60);
      H = clamp(parseInt(hInput.value||16), 5, 40);
      const maxM = Math.max(1, W*H-9);
      M = clamp(parseInt(mInput.value||40), 1, maxM);
    }else{
      customRow.style.display='none';
      const [w,h,m] = value.split('x').map(n=>parseInt(n,10));
      W=w; H=h; M=m;
    }
  }

  function clamp(n, a, b){ return Math.min(b, Math.max(a,n)); }

  // UI events
  diffSel.addEventListener('change', ()=>{ applyDifficulty(diffSel.value); newGame(); });
  [wInput,hInput,mInput].forEach(inp=> inp.addEventListener('change', ()=>{
    applyDifficulty('custom'); newGame();
  }));
  resetBtn.addEventListener('click', newGame);
  chordBtn.addEventListener('click', ()=>{
    chording = !chording;
    chordBtn.textContent = `Chording: ${chording?'On':'Off'}`;
  });

  // Keyboard helpers
  document.addEventListener('keydown', (e)=>{
    if(e.key.toLowerCase()==='r') newGame();
    if(e.code==='Space'){
      // Try chord on element under the mouse (best-effort)
      const el = document.elementFromPoint(lastMouse.x, lastMouse.y);
      const idx = Array.prototype.indexOf.call(boardEl.children, el);
      if(idx>=0){
        const c = cells[idx];
        chord(c);
      }
      e.preventDefault();
    }
  });
  const lastMouse = {x:0,y:0};
  document.addEventListener('mousemove', e=>{ lastMouse.x=e.clientX; lastMouse.y=e.clientY; });

  // Initial
  applyDifficulty(diffSel.value);
  newGame();
})();
</script>
</body>
</html>
